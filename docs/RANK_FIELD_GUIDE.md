# 排名字段功能使用指南

## 概述

排名字段功能允许您根据指定字段（如分数、成绩等）自动计算记录的排名。支持多种排名方式和排序规则。

## 功能特性

### 1. 排名类型
- **降序排名**：数值越大排名越高（第1名、第2名...）
- **升序排名**：数值越小排名越高（第1名、第2名...）

### 2. 排名方法
- **标准排名**：相同值获得相同排名，下一个不同值跳过相应数量排名
  - 示例：100, 90, 90, 80 → 1, 2, 2, 4
- **密集排名**：相同值获得相同排名，下一个不同值连续排名
  - 示例：100, 90, 90, 80 → 1, 2, 2, 3

### 3. 支持的字段类型
- 数字字段
- 单选字段
- 评分字段

## 使用方法

### 方法一：使用排名字段配置组件

1. **创建排名字段**
   ```typescript
   import { RankFieldConfig } from '@/components/field-configs'
   
   // 在字段配置中使用
   <RankFieldConfig
     value={rankConfig}
     onChange={handleRankConfigChange}
     availableFields={availableFields}
   />
   ```

2. **配置排名参数**
   - 选择用于排名的源字段
   - 设置排名顺序（升序/降序）
   - 选择排名方法（标准/密集）
   - 设置是否显示并列排名

3. **自动生成公式**
   - 系统会根据配置自动生成排名公式
   - 公式示例：`DENSE_RANK({分数字段}, DESC)`

### 方法二：使用公式编辑器

1. **创建公式字段**
   - 选择字段类型为"公式"
   - 打开公式编辑器

2. **编写排名公式**
   ```javascript
   // 标准排名，降序
   RANK({分数字段}, DESC)
   
   // 密集排名，降序
   DENSE_RANK({分数字段}, DESC)
   
   // 标准排名，升序
   RANK({分数字段}, ASC)
   
   // 密集排名，升序
   DENSE_RANK({分数字段}, ASC)
   ```

3. **保存并应用**
   - 保存公式后，系统会自动计算排名
   - 排名会根据源字段值的变化自动更新

### 方法三：使用排名公式生成器

1. **打开排名公式生成器**
   ```typescript
   import RankFormulaGenerator from '@/components/RankFormulaGenerator'
   
   <RankFormulaGenerator
     availableFields={availableFields}
     onFormulaGenerated={handleFormulaGenerated}
   />
   ```

2. **选择配置**
   - 选择排名字段
   - 选择排名顺序
   - 选择排名方法

3. **生成并复制公式**
   - 点击"生成排名公式"按钮
   - 复制生成的公式到公式字段中

## 实际应用示例

### 学生成绩排名

```javascript
// 根据总分进行降序排名
DENSE_RANK({总分}, DESC)

// 根据平均分进行升序排名（分数越低排名越高）
RANK({平均分}, ASC)
```

### 销售业绩排名

```javascript
// 根据销售额进行降序排名
RANK({销售额}, DESC)

// 根据增长率进行降序排名
DENSE_RANK({增长率}, DESC)
```

### 比赛排名

```javascript
// 根据完成时间进行升序排名（时间越短排名越高）
RANK({完成时间}, ASC)

// 根据得分进行降序排名
DENSE_RANK({得分}, DESC)
```

## 排名函数详解

### RANK 函数（标准排名）
- 相同值获得相同排名
- 下一个不同值会跳过相应数量的排名位置
- 适用于需要明确显示排名间隔的场景

### DENSE_RANK 函数（密集排名）
- 相同值获得相同排名
- 下一个不同值连续排名，不跳过位置
- 适用于需要连续排名的场景

### ROW_NUMBER 函数（行号）
- 为每行分配唯一的连续数字
- 不考虑相同值，每行都有唯一编号
- 适用于需要唯一标识的场景

## 最佳实践

### 1. 选择合适的排名方法
- 如果需要显示排名间隔，使用 `RANK`
- 如果需要连续排名，使用 `DENSE_RANK`
- 如果需要唯一编号，使用 `ROW_NUMBER`

### 2. 处理并列排名
- 标准排名：100, 90, 90, 80 → 1, 2, 2, 4
- 密集排名：100, 90, 90, 80 → 1, 2, 2, 3

### 3. 排名更新
- 当源字段值发生变化时，排名会自动重新计算
- 排名是动态的，会根据当前数据状态实时更新

## 演示和测试

### 访问排名演示
1. 在应用顶部点击"排名演示"按钮
2. 或直接访问 `/rank-demo` 路径
3. 查看排名功能的完整演示

### 演示内容包括
- 排名公式生成器
- 实时排名计算
- 不同排名方法的对比
- 实际数据示例

## 技术实现

### 组件结构
```
RankFieldConfig.tsx          # 排名字段配置组件
RankFormulaGenerator.tsx     # 排名公式生成器
RankDemo.tsx                # 排名功能演示
FormulaEditorDialog.tsx     # 公式编辑器（已扩展）
```

### 关键功能
- 字段类型过滤（只显示可用于排名的字段）
- 公式自动生成
- 实时排名计算
- 多种排名方法支持

## 注意事项

1. **字段类型限制**：只有数字、单选、评分字段可用于排名
2. **性能考虑**：大量数据时排名计算可能需要时间
3. **数据一致性**：确保源字段数据格式正确
4. **排名更新**：源字段变化时排名会自动更新

## 故障排除

### 常见问题

1. **排名不显示**
   - 检查源字段是否有数据
   - 确认字段类型是否支持排名
   - 验证公式语法是否正确

2. **排名结果异常**
   - 检查排名顺序设置（ASC/DESC）
   - 确认排名方法选择（RANK/DENSE_RANK）
   - 验证源字段数据格式

3. **排名不更新**
   - 检查源字段是否发生变化
   - 确认公式是否正确保存
   - 刷新页面或重新计算排名

## 更新日志

- **v1.0.0** - 初始版本
  - 支持标准排名和密集排名
  - 提供排名字段配置组件
  - 集成公式编辑器支持
  - 添加排名演示页面

